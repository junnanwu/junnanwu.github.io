# 深拷贝与浅拷贝

## 浅拷贝

当我们把一个对象赋值给一个新的变量的时候，赋的是该对象的在栈中的地址，而不是堆中的数据，也就是两个对象指向的同一个存储空间，两个对象是联动的。

浅拷贝是按位拷贝对象，它会创建一个新的对象，这个对象有着对原有对象的一份精确拷贝。如果属性是基本类型，那么拷贝的就是基本类型，如果属性是内存地址，拷贝的就是内存地址。

浅拷贝实现的几种方式：

- 通过构造方法实现浅拷贝

- 通过重写clone方式实现浅拷贝

  Object类的clone方法是一个native方法，该方法是被protected方法修饰，说明该方法只能被本包下或者子类方法去调用。

注意一点：虽然浅拷贝引用类型是存的引用，但是String和基本类型的包装类是比较特殊的，虽然数据引用类型，但是String类型是final类型修饰的，是无法修改的，当String类型属性改变的时候，并不是修改了这个数据的值，而是修改这个属性的引用，所以修改拷贝后的对象的String类型，拷贝前的并不会改变。

## 深拷贝

深拷贝是对整个对象图进行拷贝，花销较大。

实现深拷贝的主要方式：

- 重写clone方法
- 通过对象序列化实现深拷贝

不过要注意的是，如果某个属性被transient修饰，那么该属性就无法被拷贝了

### 阿里巴巴Java开发手册

> 【推荐】慎用Object的clone方法来拷贝对象。
>  说明: 对象clone方法默认是浅拷贝，若想实现深拷贝，需覆写clone方法实现域对象的深度遍历式拷贝。
>
>  关于基本数据类型与包装数据类型的使用标准如下:
>
> 1) 【强制】所有的 POJO 类属性必须使用包装数据类型。
>
> 2) 【强制】RPC 方法的返回值和参数必须使用包装数据类型。 
>
> 3) 【推荐】所有的局部变量使用基本数据类型。
>
> 说明: POJO 类属性没有初值是提醒使用者在需要使用时，必须自己显式地进行赋值，任何NPE问题，或者入库检查，都由使用者来保证。
> 正例:数据库的查询结果可能是 null，因为自动拆箱，用基本数据类型接收有NPE风险。 反例:某业务的交易报表上显示成交总额涨跌情况，即正负 x%，x为基本数据类型，调用的RPC服务，调用不成功时，返回的是默认值，页面显示为 0%，这是不合理的，应该显示成中划线-。所以包装数据类型 的 null 值，能够表示额外的信息，如: 远程调用失败，异常退出。

